<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>আলোচনা - ক্লাসিক টুইটার ২০১৬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Hind+Siliguri:wght@400;500;600;700&display=swap');
        
        body {
            background-color: #f5f8fa;
            font-family: 'Roboto', 'Hind Siliguri', sans-serif;
            color: #14171a;
        }

        .twitter-blue { color: #1da1f2; }
        .bg-twitter-blue { background-color: #1da1f2; }
        .border-twitter-blue { border-color: #1da1f2; }

        /* ২০১৬ টুইটার কার্ড স্টাইল */
        .tweet-card {
            background: #fff;
            border-bottom: 1px solid #e1e8ed;
            transition: background 0.2s;
            cursor: pointer;
        }
        .tweet-card:hover {
            background: #f5f8fa;
        }

        .profile-box {
            background: #fff;
            border: 1px solid #e1e8ed;
        }

        .cover-photo {
            height: 95px;
            background: #1da1f2;
        }

        .avatar-under-cover {
            margin-top: -30px;
            border: 4px solid #fff;
            border-radius: 8px;
        }

        .nav-link-active {
            border-bottom: 2px solid #1da1f2;
            color: #1da1f2;
        }

        textarea {
            resize: none;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ccd6dd; border-radius: 10px; }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="sticky top-0 z-50 bg-white border-b border-gray-200 shadow-sm">
    <div class="max-w-6xl mx-auto px-4 h-12 flex items-center justify-between">
        <div class="flex items-center gap-6 h-full text-[13px] font-bold text-gray-500">
            <a href="#" class="flex items-center gap-2 nav-link-active h-full px-2"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M22.58 7.35L12.435 2.1a1 1 0 00-.87 0L1.42 7.35a1 1 0 00-.42.82v10.73a1 1 0 00.58.91l10 4.35a1 1 0 00.84 0l10-4.35a1 1 0 00.58-.91V8.17a1 1 0 00-.42-.82zM12 4.14l8 4.12-8 3.91-8-3.91 8-4.12zM3 10.05l8 3.91v7.62l-8-3.48V10.05zm10 11.53v-7.62l8-3.91v8.05l-8 3.48z"/></svg> হোম</a>
            <a href="#" class="flex items-center gap-2 hover:text-twitter-blue h-full px-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg> নোটিফিকেশন</a>
            <a href="#" class="flex items-center gap-2 hover:text-twitter-blue h-full px-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg> মেসেজ</a>
        </div>
        
        <div class="flex items-center gap-4">
            <div class="relative hidden sm:block">
                <input type="text" placeholder="সার্চ আলোচনা" class="bg-[#f5f8fa] border border-[#e1e8ed] rounded-full px-4 py-1 text-sm w-48 focus:outline-none focus:bg-white focus:border-twitter-blue transition-all">
            </div>
            <img id="nav-avatar" class="w-8 h-8 rounded-full hidden cursor-pointer" onclick="openProfile(currentUser.uid)">
            <button id="tweet-btn-nav" onclick="toggleTweetBox()" class="bg-twitter-blue text-white px-4 py-1.5 rounded-full font-bold text-sm hover:bg-[#1991db]">টুইট</button>
            <button id="login-ui" onclick="googleLogin()" class="text-twitter-blue font-bold text-sm">লগইন</button>
        </div>
    </div>
</nav>

<div class="max-w-6xl mx-auto px-4 py-4 grid grid-cols-1 md:grid-cols-4 gap-4">
    
    <!-- Left Sidebar: Profile Card -->
    <aside class="hidden md:block col-span-1">
        <div id="sidebar-profile" class="profile-box rounded-lg overflow-hidden hidden">
            <div class="cover-photo"></div>
            <div class="px-4 pb-4">
                <img id="side-avatar" class="avatar-under-cover w-16 h-16 bg-white shadow-sm">
                <div class="mt-2">
                    <h2 id="side-name" class="font-bold text-lg hover:underline cursor-pointer">ইউজার নেম</h2>
                    <p id="side-handle" class="text-gray-500 text-sm">@username</p>
                </div>
                <div class="flex mt-4 gap-4 text-xs font-bold text-gray-500 uppercase tracking-tight">
                    <div>টুইট<br><span class="twitter-blue text-lg" id="count-tweets">০</span></div>
                    <div>ফলোয়িং<br><span class="twitter-blue text-lg" id="count-following">০</span></div>
                    <div>ফলোয়ার<br><span class="twitter-blue text-lg" id="count-followers">০</span></div>
                </div>
            </div>
        </div>
        
        <div class="profile-box rounded-lg mt-4 p-4">
            <h3 class="font-bold text-lg mb-3">ট্রেন্ডিং</h3>
            <div class="space-y-3">
                <div class="text-sm"><a href="#" class="twitter-blue font-bold hover:underline">#Bangladesh</a><br><span class="text-xs text-gray-500">৫.২কে টুইট</span></div>
                <div class="text-sm"><a href="#" class="twitter-blue font-bold hover:underline">#WebDev</a><br><span class="text-xs text-gray-500">১.৫কে টুইট</span></div>
                <div class="text-sm"><a href="#" class="twitter-blue font-bold hover:underline">#Programming</a><br><span class="text-xs text-gray-500">১২.৩কে টুইট</span></div>
            </div>
        </div>
    </aside>

    <!-- Center: Feed -->
    <main class="col-span-1 md:col-span-2 space-y-0.5">
        <!-- New Tweet Box (Header style) -->
        <div id="top-tweet-box" class="bg-[#E8F5FD] p-3 border border-[#B2DFFC] rounded-t-lg hidden">
            <div class="flex gap-3">
                <img id="tweet-box-avatar" class="w-8 h-8 rounded-md">
                <div class="flex-1">
                    <textarea id="tweet-input" placeholder="কি ঘটছে?" class="w-full p-2 border border-[#ccd6dd] rounded-lg focus:outline-none focus:border-twitter-blue" rows="3"></textarea>
                    <div class="flex justify-end mt-2">
                        <button onclick="postTweet()" class="bg-twitter-blue text-white px-5 py-1.5 rounded-full font-bold text-sm">টুইট করুন</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="feed-container" class="bg-white border border-[#e1e8ed] rounded-lg overflow-hidden">
            <div class="flex justify-center py-10"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-twitter-blue"></div></div>
        </div>
    </main>

    <!-- Right Sidebar: Who to Follow -->
    <aside class="hidden lg:block col-span-1">
        <div class="profile-box rounded-lg p-4">
            <h3 class="font-bold text-lg mb-4">কাকে ফলো করবেন</h3>
            <div id="who-to-follow" class="space-y-4">
                <!-- User Suggestions -->
            </div>
            <div class="mt-4 pt-4 border-t border-gray-100">
                <a href="#" class="twitter-blue text-xs hover:underline">বন্ধুদের খুঁজে পান</a>
            </div>
        </div>
        <div class="text-[11px] text-gray-500 p-4 leading-tight">
            © ২০১৬ আলোচনা  সহায়তা  শর্তাবলী  প্রাইভেসি  কুকি  বিজ্ঞাপন তথ্য
        </div>
    </aside>
</div>

<!-- Scripts -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, serverTimestamp, orderBy } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyB_xkcJ87-E4jkYIDT2dBxOFJHUQvZxbU8",
        authDomain: "myblogcomments-22808.firebaseapp.com",
        projectId: "myblogcomments-22808",
        storageBucket: "myblogcomments-22808.firebasestorage.app",
        messagingSenderId: "1067155293144",
        appId: "1:1067155293144:web:8f10b016462b52d36628ad"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    const forumCol = collection(db, 'blog_comments', 'pages', 'twitter_2016');

    window.currentUser = null;
    let tweets = [];

    onAuthStateChanged(auth, (user) => {
        window.currentUser = user;
        const loginBtn = document.getElementById('login-ui');
        const navAvatar = document.getElementById('nav-avatar');
        const sideProfile = document.getElementById('sidebar-profile');
        const topTweetBox = document.getElementById('top-tweet-box');

        if (user) {
            loginBtn.classList.add('hidden');
            navAvatar.classList.remove('hidden');
            navAvatar.src = user.photoURL;
            sideProfile.classList.remove('hidden');
            topTweetBox.classList.remove('hidden');
            
            document.getElementById('side-avatar').src = user.photoURL;
            document.getElementById('side-name').innerText = user.displayName;
            document.getElementById('side-handle').innerText = '@' + user.uid.substring(0, 8);
            document.getElementById('tweet-box-avatar').src = user.photoURL;
            
            updateStats();
        } else {
            loginBtn.classList.remove('hidden');
            navAvatar.classList.add('hidden');
            sideProfile.classList.add('hidden');
            topTweetBox.classList.add('hidden');
        }
        loadTweets();
    });

    window.googleLogin = async () => { try { await signInWithPopup(auth, provider); } catch(e){} };

    async function loadTweets() {
        try {
            const snap = await getDocs(query(forumCol));
            tweets = [];
            snap.forEach(doc => tweets.push({ id: doc.id, ...doc.data() }));
            tweets.sort((a,b) => (b.at?.seconds || 0) - (a.at?.seconds || 0));
            render();
            updateSuggestions();
        } catch(e) {}
    }

    function render() {
        const container = document.getElementById('feed-container');
        container.innerHTML = tweets.map(t => `
            <div class="tweet-card p-4 flex gap-3">
                <img src="${t.photoURL}" class="w-12 h-12 rounded-lg cursor-pointer">
                <div class="flex-1">
                    <div class="flex items-center gap-1 mb-1">
                        <span class="font-bold hover:text-twitter-blue cursor-pointer">${t.name}</span>
                        <span class="text-gray-500 text-sm">@${t.userId?.substring(0, 6)} • ${formatTime(t.at)}</span>
                    </div>
                    <div class="text-[15px] leading-tight mb-3">
                        ${DOMPurify.sanitize(t.msg)}
                    </div>
                    <div class="flex justify-between max-w-xs text-gray-500">
                        <button class="flex items-center gap-2 hover:text-twitter-blue transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
                            <span class="text-xs font-bold">${toBN(Math.floor(Math.random()*10))}</span>
                        </button>
                        <button class="flex items-center gap-2 hover:text-green-500 transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path></svg>
                            <span class="text-xs font-bold">${toBN(Math.floor(Math.random()*20))}</span>
                        </button>
                        <button class="flex items-center gap-2 hover:text-red-500 transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                            <span class="text-xs font-bold">${toBN(Math.floor(Math.random()*50))}</span>
                        </button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    window.postTweet = async () => {
        const input = document.getElementById('tweet-input');
        const msg = input.value.trim();
        if (!msg || !currentUser) return;

        try {
            await addDoc(forumCol, {
                name: currentUser.displayName,
                msg: msg,
                photoURL: currentUser.photoURL,
                userId: currentUser.uid,
                at: serverTimestamp()
            });
            input.value = '';
            loadTweets();
        } catch(e) {}
    };

    function updateStats() {
        if (!currentUser) return;
        const count = tweets.filter(t => t.userId === currentUser.uid).length;
        document.getElementById('count-tweets').innerText = toBN(count);
        document.getElementById('count-following').innerText = toBN(Math.floor(Math.random()*500));
        document.getElementById('count-followers').innerText = toBN(Math.floor(Math.random()*1000));
    }

    function updateSuggestions() {
        const whoToFollow = document.getElementById('who-to-follow');
        // Get unique users from tweets
        const uniqueUsers = Array.from(new Set(tweets.map(t => t.userId)))
            .map(uid => tweets.find(t => t.userId === uid))
            .filter(u => u.userId !== currentUser?.uid)
            .slice(0, 3);

        whoToFollow.innerHTML = uniqueUsers.map(u => `
            <div class="flex items-center justify-between">
                <div class="flex gap-2">
                    <img src="${u.photoURL}" class="w-8 h-8 rounded-md">
                    <div class="leading-tight">
                        <div class="text-xs font-bold hover:underline cursor-pointer">${u.name}</div>
                        <div class="text-[11px] text-gray-500">@${u.userId.substring(0,6)}</div>
                    </div>
                </div>
                <button class="border border-twitter-blue text-twitter-blue px-3 py-1 rounded-full text-[11px] font-bold hover:bg-[#e8f5fd]">ফলো</button>
            </div>
        `).join('') || '<p class="text-xs text-gray-400 italic">এখনো কেউ নেই</p>';
    }

    window.toggleTweetBox = () => {
        const input = document.getElementById('tweet-input');
        input.focus();
        input.scrollIntoView({ behavior: 'smooth', block: 'center' });
    };

    const toBN = (n) => n.toString().replace(/\d/g, d => "০১২৩৪৫৬৭৮৯"[d]);
    function formatTime(ts) {
        if(!ts) return 'এখন';
        const s = Math.floor((new Date() - new Date(ts.seconds * 1000))/1000);
        if(s < 60) return toBN(s) + 'সে';
        if(s < 3600) return toBN(Math.floor(s/60)) + 'মি';
        if(s < 86400) return toBN(Math.floor(s/3600)) + 'ঘ';
        return new Date(ts.seconds*1000).toLocaleDateString('bn-BD', {day:'numeric', month:'short'});
    }
</script>
</body>
</html>

